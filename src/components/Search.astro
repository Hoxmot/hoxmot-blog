---

---

<dialog
  id="search-dialog"
  class="m-auto rounded-lg bg-transparent p-0 shadow-2xl backdrop:bg-gray-900/50 dark:backdrop:bg-gray-900/80"
>
  <div
    class="relative w-[90vw] max-w-lg rounded-lg border border-gray-200 bg-bg-card p-6 text-text-main dark:border-gray-700"
  >
    <div class="mb-4 flex items-center justify-between">
      <h2 class="font-mono text-xl font-bold">Search</h2>
      <button
        id="close-search"
        class="text-text-muted transition-colors hover:text-primary"
        aria-label="Close search"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
    <div id="pagefind-search" class="min-h-[100px]"></div>
  </div>
</dialog>

<!-- Pagefind UI CSS/JS are generated at build time -->
<link href="/pagefind/pagefind-ui.css" rel="stylesheet" />
<script is:inline src="/pagefind/pagefind-ui.js"></script>

<script>
  const dialog = document.getElementById('search-dialog') as HTMLDialogElement;
  const closeBtn = document.getElementById('close-search');

  // Close functionality
  closeBtn?.addEventListener('click', () => dialog?.close());
  dialog?.addEventListener('click', (e) => {
    if (e.target === dialog) dialog.close();
  });

  // Initialize Pagefind
  window.addEventListener('DOMContentLoaded', () => {
    // @ts-expect-error - PagefindUI is added to window by the script tag above
    if (window.PagefindUI) {
      // @ts-expect-error - PagefindUI constructor is not typed on window
      new window.PagefindUI({
        element: '#pagefind-search',
        showSubResults: true,
        showImages: false,
        translations: {
          placeholder: 'Search articles...',
        },
      });
    }
  });
</script>

<style is:global>
  /* 1. Default (Light Mode) Variables */
  :root {
    --pagefind-ui-scale: 1;
    --pagefind-ui-primary: var(--color-primary);
    --pagefind-ui-text: var(--color-text-main);
    --pagefind-ui-background: var(--color-bg-card);
    --pagefind-ui-border: #e5e7eb;
    --pagefind-ui-tag: #e5e7eb;
    --pagefind-ui-border-width: 1px;
    --pagefind-ui-border-radius: 0.5rem;
    --pagefind-ui-image-border-radius: 0.5rem;
    --pagefind-ui-image-box-ratio: 3 / 2;
    --pagefind-ui-font: 'Inter', sans-serif;
  }

  /* 2. Dark Mode Variable Overrides applied directly to the container */
  .dark #pagefind-search {
    --pagefind-ui-primary: var(--color-primary);
    --pagefind-ui-text: var(--color-text-main);
    --pagefind-ui-background: var(--color-bg-card);
    --pagefind-ui-border: #374151;
    --pagefind-ui-tag: #374151;
  }

  /* 3. Force Dark Mode styles for specific Pagefind elements if variables fail */
  .dark .pagefind-ui__search-input {
    color: var(--color-text-main) !important;
    background-color: var(--color-bg-card) !important;
    border-color: #374151 !important;
  }

  .dark .pagefind-ui__result-title,
  .dark .pagefind-ui__result-link {
    color: var(--color-text-main) !important;
  }

  .dark .pagefind-ui__result-excerpt {
    color: var(--color-text-muted) !important;
  }

  /* Hide the default "Searching..." text in dev mode since script won't load */
  #pagefind-search:empty::before {
    content: 'Search is available in production builds only.';
    display: block;
    color: var(--color-text-muted);
    font-family: 'Inter', sans-serif;
    font-size: 0.875rem;
    text-align: center;
    padding: 1rem;
  }
</style>
